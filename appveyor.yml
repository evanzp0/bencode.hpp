build: false
version: "{branch}-{build}"

environment:
  VS: C:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\vcvarsall.bat
  BOOST_INCLUDEDIR: C:\Libraries\boost_1_60_0
  BOOST_LIBRARYDIR: C:\Libraries\boost_1_60_0\lib32-msvc-14.0
  PYTHON_PATH: C:\Python27

cache:
  - C:\ProgramData\chocolatey\bin -> appveyor.yml
  - C:\ProgramData\chocolatey\lib -> appveyor.yml

install:
  - cinst ninja
  - call "%VS%" x86
  - set PATH=%PYTHON_PATH%;%PYTHON_PATH%\Scripts;%PATH%

  # Install the latest master revision of bfg9000.
  - git clone https://github.com/jimporter/bfg9000.git
  - cd bfg9000
  - python setup.py install
  - cd ..

  # Install the latest master revision of mettle.
  - git clone https://github.com/jimporter/mettle.git
  - cd mettle
  - copy ..\include\bencode.hpp include\bencode.hpp
  - 9k build --backend=ninja --prefix=C:\mettle
  - cd build
  - ninja install
  - cd ..\..
test_script:
  - set PATH=C:\mettle;%PATH%
  - set LIBRARY_PATH=C:\mettle
  - set CPPFLAGS=/WX /IC:\mettle
  - 9k build --backend=ninja
  - cd build
  - ninja test
